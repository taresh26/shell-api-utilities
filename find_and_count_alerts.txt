#!/bin/bash

# Check if at least one argument is provided
if [ "$#" -lt 1 ]; then
    echo "Usage: $0 <log_file> [search_pattern]"
    exit 1
fi

LOG_FILE=$1
SEARCH_PATTERN=$2

# Check if the log file exists
if [ ! -f "$LOG_FILE" ]; then
    echo "Error: Log file '$LOG_FILE' not found."
    exit 1
fi

# Initialize counters
declare -A error_counts
declare -A warning_counts
declare -A alert_counts

# Function to count occurrences and display matched lines
find_and_count_occurrences() {
    local line
    while IFS= read -r line; do
        if [[ $line == *"ERROR"* ]]; then
            ((error_counts["ERROR"]++))
            echo "$line"  # Display the matching line
        elif [[ $line == *"WARNING"* ]]; then
            ((warning_counts["WARNING"]++))
            echo "$line"  # Display the matching line
        elif [[ $line == *"ALERT"* ]]; then
            ((alert_counts["ALERT"]++))
            echo "$line"  # Display the matching line
        fi
    done < <(awk -v pattern="$SEARCH_PATTERN" '$0 ~ pattern || pattern == "" { print }' "$LOG_FILE")
}

# Find and count occurrences
find_and_count_occurrences

# Display results
echo "Counts:"
echo "ERROR: ${error_counts["ERROR"]:-0}"
echo "WARNING: ${warning_counts["WARNING"]:-0}"
echo "ALERT: ${alert_counts["ALERT"]:-0}"
